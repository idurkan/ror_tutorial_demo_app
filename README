Implementation from chapter 2 of http://ruby.railstutorial.org/
